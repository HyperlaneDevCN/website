"use strict";(self.webpackChunkhyperlane_dev_cn_website=self.webpackChunkhyperlane_dev_cn_website||[]).push([[4601],{7656:(e,n,i)=>{i.d(n,{Ay:()=>l,RM:()=>a});var s=i(74848),r=i(28453);const a=[];function d(e){const n={mermaid:"mermaid",...(0,r.R)(),...e.components};return(0,s.jsx)(n.mermaid,{value:'flowchart LR\n    subgraph Origin Chain\n      Sender\n      M_O[(Mailbox)]\n      Sender -- "dispatch(destination, recipient, body)" --\x3e M_O\n    end\n\n    subgraph Destination Chain\n      Recipient[Recipient]\n      M_D[(Mailbox)]\n\n      M_D -- "handle(origin, sender, body)" --\x3e Recipient\n    end\n\n    M_O -. "relay" .-> M_D'})}function l(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},17561:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>x,contentTitle:()=>h,default:()=>m,frontMatter:()=>c,metadata:()=>s,toc:()=>u});const s=JSON.parse('{"id":"reference/messaging/send","title":"\u53d1\u9001\u6d88\u606f","description":"\u5f00\u53d1\u8005\u901a\u8fc7\u8c03\u7528 Mailbox.dispatch() \u6765\u53d1\u9001\u8de8\u94fe\u6d88\u606f\u3002","source":"@site/docs/reference/messaging/send.mdx","sourceDirName":"reference/messaging","slug":"/reference/messaging/send","permalink":"/docs/reference/messaging/send","draft":false,"unlisted":false,"editUrl":"https://github.com/HyperlaneDevCN/website/tree/master/docs/reference/messaging/send.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"protocolSidebar","previous":{"title":"\u90ae\u7bb1","permalink":"/docs/protocol/mailbox"},"next":{"title":"\u63a5\u6536\u6d88\u606f","permalink":"/docs/reference/messaging/receive"}}');var r=i(74848),a=i(28453),d=i(62464),l=i(14345),o=i(27658),t=i(7656);const c={},h="\u53d1\u9001\u6d88\u606f",x={},u=[...t.RM,{value:"Dispatch",id:"dispatch",level:2},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:3},{value:"\u67e5\u8be2\u53d1\u9001\u8d39\u7528",id:"\u67e5\u8be2\u53d1\u9001\u8d39\u7528",level:2},{value:"\u793a\u4f8b",id:"\u793a\u4f8b-1",level:3},{value:"Post-Dispatch \u94a9\u5b50\u914d\u7f6e",id:"post-dispatch-\u94a9\u5b50\u914d\u7f6e",level:2},{value:"Required \u94a9\u5b50",id:"required-\u94a9\u5b50",level:3},{value:"Default \u94a9\u5b50",id:"default-\u94a9\u5b50",level:3}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"\u53d1\u9001\u6d88\u606f",children:"\u53d1\u9001\u6d88\u606f"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5f00\u53d1\u8005\u901a\u8fc7\u8c03\u7528 ",(0,r.jsx)(n.code,{children:"Mailbox.dispatch()"})," \u6765\u53d1\u9001\u8de8\u94fe\u6d88\u606f\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u8be5\u51fd\u6570\u63a5\u6536\u6d88\u606f\u5185\u5bb9\u3001\u76ee\u6807\u94fe ID \u548c\u63a5\u6536\u8005\u5730\u5740\u4f5c\u4e3a\u53c2\u6570\u3002\u6bcf\u6761\u6d88\u606f\u90fd\u4f1a\u4f5c\u4e3a\u53f6\u5b50\u8282\u70b9\u63d2\u5165\u5230 ",(0,r.jsx)(n.code,{children:"Mailbox"})," \u5b58\u50a8\u7684",(0,r.jsx)(n.a,{href:"https://medium.com/@josephdelong/ethereum-2-0-deposit-merkle-tree-13ec8404ca4f",children:"\u589e\u91cf\u9ed8\u514b\u5c14\u6811"}),"\u4e2d\u3002Hyperlane \u7684\u6743\u76ca\u8bc1\u660e\u534f\u8bae\u4f7f\u7528\u8fd9\u4e2a\u9ed8\u514b\u5c14\u6811\u6765\u9a8c\u8bc1\u6b3a\u8bc8\u8bc1\u660e\u3002"]}),"\n",(0,r.jsx)(t.Ay,{}),"\n",(0,r.jsx)(n.h2,{id:"dispatch",children:"Dispatch"}),"\n",(0,r.jsx)(n.p,{children:"\u8c03\u7528\u6b64\u51fd\u6570\u53ef\u5c06\u6d88\u606f\u53d1\u9001\u5230\u76ee\u6807\u57df\u548c\u63a5\u6536\u8005\u3002"}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["Hyperlane \u53ea\u80fd\u5411\u5b9e\u73b0\u4e86 ",(0,r.jsx)(n.code,{children:"handle"})," \u51fd\u6570\u7684\u667a\u80fd\u5408\u7ea6\u6295\u9012\u6d88\u606f\u3002\u67e5\u770b",(0,r.jsx)(n.a,{href:"/docs/reference/messaging/receive",children:"\u63a5\u6536\u6d88\u606f"}),"\u6587\u6863\u83b7\u53d6\u66f4\u591a\u4fe1\u606f\u3002"]})}),"\n",(0,r.jsxs)(n.p,{children:["\u6839\u636e",(0,r.jsxs)(n.a,{href:"##post-dispatch-hook-config",children:["post-",(0,r.jsx)(n.code,{children:"dispatch"})," \u94a9\u5b50\u914d\u7f6e"]}),",\u53ef\u80fd\u9700\u8981\u652f\u4ed8\u4e00\u4e9b\u8d39\u7528\u3002\u67e5\u770b ",(0,r.jsx)(n.a,{href:"#quote-dispatch",children:(0,r.jsx)(n.code,{children:"quoteDispatch"})})," \u90e8\u5206\u83b7\u53d6\u66f4\u591a\u4fe1\u606f\u3002"]}),"\n",(0,r.jsx)(d.A,{groupId:"lang",children:(0,r.jsxs)(l.A,{value:"sol",label:"Solidity",children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",metastring:"file=<rootDir>/node_modules/@hyperlane-xyz/core/contracts/interfaces/IMailbox.sol#L59-L63",children:"function dispatch(\n    uint32 destinationDomain,\n    bytes32 recipientAddress,\n    bytes calldata messageBody\n) external payable returns (bytes32 messageId);\n"})}),(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsxs)(n.p,{children:["\u4e3a\u4e86\u517c\u5bb9\u4e0d\u540c\u5bfb\u5740\u65b9\u5f0f\u7684\u865a\u62df\u673a,\u63a5\u6536\u8005\u5730\u5740\u4f1a\u5de6\u586b\u5145\u81f3 ",(0,r.jsx)(n.code,{children:"bytes32"}),"\u3002",(0,r.jsxs)(n.a,{href:"/docs/reference/libraries/typecasts",children:[(0,r.jsx)(n.code,{children:"TypeCasts"})," \u5e93"]}),"\u63d0\u4f9b\u4e86\u4ee5\u4e0b\u5b9e\u7528\u5de5\u5177:"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",metastring:"file=<rootDir>/node_modules/@hyperlane-xyz/core/contracts/libs/TypeCasts.sol#L5-L8",children:"// alignment preserving cast\nfunction addressToBytes32(address _addr) internal pure returns (bytes32) {\n    return bytes32(uint256(uint160(_addr)));\n}\n"})})]})]})}),"\n",(0,r.jsx)(n.h3,{id:"\u793a\u4f8b",children:"\u793a\u4f8b"}),"\n",(0,r.jsx)(o.W,{solidity:({mailbox:e,originChain:n,destinationDomain:i,destinationChain:s,paddedRecipient:r,body:a})=>`// \u4ece ${n} \u53d1\u9001\u6d88\u606f\u5230 ${s} \u7684 TestRecipient\nIMailbox mailbox = IMailbox("${e}");\nbytes32 messageId = mailbox.dispatch{value: msg.value}(\n  ${i},\n  "${r}",\n  bytes("${a}")\n);`}),"\n",(0,r.jsx)(n.h2,{id:"\u67e5\u8be2\u53d1\u9001\u8d39\u7528",children:"\u67e5\u8be2\u53d1\u9001\u8d39\u7528"}),"\n",(0,r.jsxs)(n.p,{children:["\u901a\u5e38\u4f1a\u914d\u7f6e\u8d39\u7528\u6765\u652f\u4ed8 IGP \u652f\u4ed8\u4ee5\u53ca\u534f\u8bae\u6210\u672c\u3002\u8fd9\u5305\u62ec\u76ee\u6807\u94fe\u4e0a\u7684\u4ea4\u6613\u63d0\u4ea4\u3001\u5b89\u5168\u4fdd\u969c\u548c\u7ef4\u62a4\u8d39\u7528\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528 ",(0,r.jsx)(n.code,{children:"quoteDispatch"})," \u51fd\u6570\u6765\u83b7\u53d6\u76f8\u5e94 ",(0,r.jsx)(n.code,{children:"dispatch"})," \u8c03\u7528\u7684\u8d39\u7528\u62a5\u4ef7\u3002"]}),"\n",(0,r.jsx)(n.mermaid,{value:'flowchart TB\n    subgraph Origin Chain\n      Sender\n      M_O[(Mailbox)]\n      Sender <-- "fee = quoteDispatch(...)" --\x3e M_O\n      Sender -- "dispatch(...){fee}" --\x3e M_O\n    end'}),"\n",(0,r.jsx)(d.A,{groupId:"lang",children:(0,r.jsxs)(l.A,{value:"sol",label:"Solidity",children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",metastring:"file=<rootDir>/node_modules/@hyperlane-xyz/core/contracts/interfaces/IMailbox.sol#L65-L69",children:"function quoteDispatch(\n    uint32 destinationDomain,\n    bytes32 recipientAddress,\n    bytes calldata messageBody\n) external view returns (uint256 fee);\n"})}),(0,r.jsxs)(n.p,{children:["\u5fc5\u987b\u5c06\u62a5\u4ef7\u7684 ",(0,r.jsx)(n.code,{children:"fee"})," \u4f5c\u4e3a value \u4f20\u9012\u7ed9 ",(0,r.jsx)(n.code,{children:"dispatch"})," \u8c03\u7528\u4ee5\u786e\u4fdd\u5b83\u4e0d\u4f1a\u56de\u6eda\u3002"]})]})}),"\n",(0,r.jsx)(n.h3,{id:"\u793a\u4f8b-1",children:"\u793a\u4f8b"}),"\n",(0,r.jsx)(o.W,{solidity:({mailbox:e,originChain:n,destinationDomain:i,destinationChain:s,paddedRecipient:r,body:a})=>`// \u67e5\u8be2\u4ece ${n} \u53d1\u9001\u6d88\u606f\u5230 ${s} TestRecipient \u7684\u8d39\u7528\nIMailbox mailbox = IMailbox("${e}");\nuint32 destination = ${i};\nbytes32 recipient = "${r}";\nbytes memory body = bytes("${a}");\nuint256 fee = mailbox.quoteDispatch(destination, recipient, body);\nmailbox.dispatch{value: fee}(destination, recipient, body);\n`}),"\n",(0,r.jsx)(n.admonition,{type:"danger",children:(0,r.jsxs)(n.p,{children:["\u5411 ",(0,r.jsx)(n.code,{children:"dispatch"})," \u652f\u4ed8\u7684\u8d39\u7528\u4e0d\u8db3\u4f1a\u5bfc\u81f4\u56de\u6eda\u3002\u5982\u679c\u4f60\u7ec4\u5408\u4f7f\u7528\u591a\u4e2a\u94a9\u5b50,\u8d85\u989d\u652f\u4ed8\u7684\u8d39\u7528",(0,r.jsx)(n.strong,{children:"\u53ef\u80fd\u4e0d\u4f1a"}),"\u9000\u8fd8\u7ed9\u6d88\u606f\u53d1\u9001\u8005\u3002"]})}),"\n",(0,r.jsx)(n.h2,{id:"post-dispatch-\u94a9\u5b50\u914d\u7f6e",children:"Post-Dispatch \u94a9\u5b50\u914d\u7f6e"}),"\n",(0,r.jsx)(n.p,{children:"Mailbox \u4e0a\u914d\u7f6e\u4e86\u4e24\u4e2a\u94a9\u5b50:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"required"}),": \u5bf9\u6240\u6709\u652f\u4ed8\u4e86\u6240\u9700\u8d39\u7528\u7684 ",(0,r.jsx)(n.code,{children:"dispatch"})," \u8c03\u7528\u90fd\u4f1a\u89e6\u53d1"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"default"}),": \u5728 ",(0,r.jsx)(n.code,{children:"required"})," \u94a9\u5b50\u4e4b\u540e\u4f7f\u7528\u5269\u4f59 value \u89e6\u53d1(\u9664\u975e\u88ab\u8986\u76d6)"]}),"\n"]}),"\n",(0,r.jsx)(n.mermaid,{value:'flowchart LR\n    subgraph Origin Chain\n      Sender\n      M_O[(Mailbox)]\n      R_H[RequiredHook]\n      D_H[DefaultHook]\n      Sender -- "dispatch(...){value}" --\x3e M_O\n\n      M_O -. "fee = quoteDispatch(...)" .- R_H\n      M_O -- "postDispatch(...)<br>{fee}" --\x3e R_H\n      M_O -- "postDispatch(...)<br>{value - fee}" --\x3e D_H\n    end'}),"\n",(0,r.jsx)(n.h3,{id:"required-\u94a9\u5b50",children:"Required \u94a9\u5b50"}),"\n",(0,r.jsxs)(n.p,{children:["\u4f60\u53ef\u4ee5\u8c03\u7528 ",(0,r.jsx)(n.code,{children:"requiredHook"})," \u51fd\u6570\u67e5\u8be2 required \u94a9\u5b50\u914d\u7f6e\u3002"]}),"\n",(0,r.jsx)(d.A,{groupId:"lang",children:(0,r.jsx)(l.A,{value:"sol",label:"Solidity",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",metastring:"file=<rootDir>/node_modules/@hyperlane-xyz/core/contracts/interfaces/IMailbox.sol#L55",children:"function requiredHook() external view returns (IPostDispatchHook);\n"})})})}),"\n",(0,r.jsx)(n.h3,{id:"default-\u94a9\u5b50",children:"Default \u94a9\u5b50"}),"\n",(0,r.jsxs)(n.p,{children:["\u4f60\u53ef\u4ee5\u8c03\u7528 ",(0,r.jsx)(n.code,{children:"defaultHook"})," \u51fd\u6570\u67e5\u8be2 default \u94a9\u5b50\u914d\u7f6e\u3002"]}),"\n",(0,r.jsx)(d.A,{groupId:"lang",children:(0,r.jsx)(l.A,{value:"sol",label:"Solidity",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",metastring:"file=<rootDir>/node_modules/@hyperlane-xyz/core/contracts/interfaces/IMailbox.sol#L53",children:"function defaultHook() external view returns (IPostDispatchHook);\n"})})})}),"\n",(0,r.jsxs)(n.p,{children:["\u8981\u5728 ",(0,r.jsx)(n.code,{children:"dispatch"})," \u8c03\u7528\u4e2d\u7528\u81ea\u5b9a\u4e49\u94a9\u5b50\u8986\u76d6\u9ed8\u8ba4\u94a9\u5b50,\u8bf7\u53c2\u9605",(0,r.jsx)(n.a,{href:"/docs/reference/hooks/overview",children:"\u94a9\u5b50\u53c2\u8003"}),"\u3002"]})]})}function m(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},27658:(e,n,i)=>{i.d(n,{A:()=>x,W:()=>u});var s=i(96540),r=i(60496),a=i(92293),d=i(96506),l=i(57480),o=i(14345),t=i(62464),c=i(88308),h=i(74848);function x(e){const n=(0,c.sZ)(!0),[i,l]=(0,s.useState)(n[0]),[o,t]=(0,s.useState)(n[1]),[x,u]=(0,s.useState)("Hello, world"),p=a.F[i].domainId,m=a.F[o].domainId,j=d.y[i]?.mailbox,g=d.y[i]?.merkleTreeHook,b=d.y[i]?.testRecipient,f=(void 0===y&&(y=32),(v=b).startsWith("0x")&&(v=v.slice(2)),"0x"+v.padStart(2*y,"0"));var v,y;return(0,h.jsxs)("div",{children:[(0,h.jsxs)("div",{className:"container row",children:[(0,h.jsx)("div",{className:"margin-horiz--sm",children:(0,h.jsx)(r.on,{label:"origin",chain:i,onChange:l})}),(0,h.jsx)("div",{className:"margin-horiz--sm",children:(0,h.jsx)(r.on,{label:"destination",chain:o,onChange:t})}),(0,h.jsxs)("div",{className:"margin-horiz--sm",children:["body:","\t",(0,h.jsx)("input",{defaultValue:x,onChange:e=>u(e.target.value)})]})]}),e.exampleCode({mailbox:j,merkleTreeHook:g,originChain:i,originDomain:p,destinationChain:o,destinationDomain:m,recipient:b,paddedRecipient:f,body:x,value:"0.01"})]})}const u=e=>x({exampleCode:n=>(0,h.jsxs)(t.A,{groupId:"lang",children:[(0,h.jsx)(o.A,{value:"sol",label:"Solidity",children:(0,h.jsx)(l.A,{language:"solidity",children:e.solidity(n)})}),(0,h.jsx)(o.A,{value:"cw",label:"CosmWasm",children:"\ud83d\udea7 Coming soon! \ud83d\udea7"}),(0,h.jsx)(o.A,{value:"sl",label:"Sealevel",children:"\ud83d\udea7 Coming soon! \ud83d\udea7"})]})})},60496:(e,n,i)=>{i.d(n,{on:()=>t,Ay:()=>o});var s,r=i(88308);!function(e){e.Ethereum="ethereum",e.Sealevel="sealevel",e.Cosmos="cosmos"}(s||(s={}));s.Ethereum,s.Sealevel,s.Cosmos;var a;!function(e){e[e.NONE=0]="NONE",e[e.PROCESSED=1]="PROCESSED"}(a||(a={}));var d=i(92293),l=i(74848);function o(e){let{chains:n,label:i,onChange:s,chain:r}=e;return(0,l.jsxs)("div",{children:[i,":",(0,l.jsxs)("div",{className:"dropdown dropdown--hoverable margin-left--xs",children:[(0,l.jsx)("button",{className:"button button--secondary navbar__link",children:r}),(0,l.jsx)("ul",{className:"dropdown__menu",children:n.map((e=>(0,l.jsx)("li",{children:(0,l.jsx)("a",{className:"dropdown__link",href:`#${i}=${e}`,onClick:()=>s(e),children:e})},e)))})]})]})}function t(e){return o({chains:(0,r.sZ)(!0).filter((e=>d.F[e].protocol===s.Ethereum)),...e})}},88308:(e,n,i)=>{i.d(n,{sZ:()=>t});var s=i(92293),r=i(96506),a=i(96540);const d="abacus works",l=[];function o(e){return void 0===e&&(e=!1),function(e,n){return void 0===e&&(e=!1),void 0===n&&(n=!0),Object.values(s.F).filter((i=>{const s=i.deployer?.name.trim().toLowerCase()===d,a=!!i.isTestnet===e,o=!n||!!r.y[i.name]?.mailbox,t=l.includes(i.name);return s&&a&&o&&!t}))}(e).map((e=>e.name))}function t(e){return void 0===e&&(e=!1),(0,a.useMemo)((()=>o(e)),[e])}}}]);