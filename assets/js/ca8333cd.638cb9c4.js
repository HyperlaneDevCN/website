"use strict";(self.webpackChunkhyperlane_dev_cn_website=self.webpackChunkhyperlane_dev_cn_website||[]).push([[7627],{28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var r=s(96540);const i={},t=r.createContext(i);function a(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(t.Provider,{value:n},e.children)}},31281:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>c});var r=s(31406),i=s(74848),t=s(28453);const a={title:"Hyperlane \u6df1\u5ea6\u89e3\u6790\uff083\uff09\uff1a\u6784\u5efa\u8de8\u94fe\u901a\u4fe1\u5b9e\u8df5\u2014\u4e52\u4e53\u7403\u793a\u4f8b",description:"\u6784\u5efa\u8de8\u94fe\u901a\u4fe1\u5b9e\u8df5\u2014\u4e52\u4e53\u7403\u793a\u4f8b",slug:"in-depth-analysis-03",authors:["wangeguo","HyperlaneCC"],tags:["hyperlane","\u8de8\u94fe\u6865","\u901a\u4fe1\u5b9e\u8df5","\u793a\u4f8b"],image:"https://cdn.prod.website-files.com/6686ac1afeef42fcf1929457/6686c26718cec2e458cc5d7a_logo.svg",hide_table_of_contents:!0},o="Hyperlane \u6df1\u5ea6\u89e3\u6790\uff083\uff09\uff1a\u6784\u5efa\u8de8\u94fe\u901a\u4fe1\u5b9e\u8df5\u2014\u4e52\u4e53\u7403\u793a\u4f8b",l={authorsImageUrls:[void 0,void 0]},c=[{value:"\u793a\u4f8b\u6982\u89c8",id:"\u793a\u4f8b\u6982\u89c8",level:2},{value:"\u5f00\u53d1\u73af\u5883\u51c6\u5907",id:"\u5f00\u53d1\u73af\u5883\u51c6\u5907",level:2},{value:"\u6d4b\u8bd5\u4ee3\u5e01",id:"\u6d4b\u8bd5\u4ee3\u5e01",level:3},{value:"\u5c06\u7f51\u7edc\u6dfb\u52a0\u5230 Hardhat",id:"\u5c06\u7f51\u7edc\u6dfb\u52a0\u5230-hardhat",level:3},{value:"\u4e52\u4e53\u7403\u5408\u7ea6",id:"\u4e52\u4e53\u7403\u5408\u7ea6",level:2},{value:"ISM\u5408\u540c",id:"ism\u5408\u540c",level:2},{value:"\u90e8\u7f72\u5408\u7ea6",id:"\u90e8\u7f72\u5408\u7ea6",level:2},{value:"\u5c06 Pong \u90e8\u7f72\u5230 Sapphire Testnet",id:"\u5c06-pong-\u90e8\u7f72\u5230-sapphire-testnet",level:3},{value:"\u5c06 Ping \u90e8\u7f72\u5230 Arbitrum Sepolia",id:"\u5c06-ping-\u90e8\u7f72\u5230-arbitrum-sepolia",level:3},{value:"\u90e8\u7f72 ISM \u5230 Arbitrum Sepolia",id:"\u90e8\u7f72-ism-\u5230-arbitrum-sepolia",level:3},{value:"\u5408\u7ea6\u8bbe\u7f6e",id:"\u5408\u7ea6\u8bbe\u7f6e",level:2},{value:"\u6ce8\u518c\u8def\u7531\u5668  <code>Router</code>",id:"\u6ce8\u518c\u8def\u7531\u5668--router",level:3},{value:"\u5728 Sapphire Testnet \u4e0a\u6ce8\u518c Router",id:"\u5728-sapphire-testnet-\u4e0a\u6ce8\u518c-router",level:4},{value:"\u5728 Arbitrum Sepolia \u4e0a\u6ce8\u518c Router",id:"\u5728-arbitrum-sepolia-\u4e0a\u6ce8\u518c-router",level:4},{value:"\u5728 Arbitrum Sepolia \u6ce8\u518c ISM",id:"\u5728-arbitrum-sepolia-\u6ce8\u518c-ism",level:4},{value:"\u8fd0\u884c\u4e2d\u7ee7\u5668",id:"\u8fd0\u884c\u4e2d\u7ee7\u5668",level:2},{value:"\u6267\u884c\u4e52\u4e53\u7403",id:"\u6267\u884c\u4e52\u4e53\u7403",level:2},{value:"\u9a8c\u8bc1\u4e52\u4e53",id:"\u9a8c\u8bc1\u4e52\u4e53",level:2},{value:"\u6545\u969c\u6392\u9664",id:"\u6545\u969c\u6392\u9664",level:2},{value:"\u4e2d\u7ee7\u5668\u4e0d\u4e2d\u7ee7\u6d88\u606f",id:"\u4e2d\u7ee7\u5668\u4e0d\u4e2d\u7ee7\u6d88\u606f",level:3},{value:"\u65e0\u6cd5\u9a8c\u8bc1\u6d88\u606f",id:"\u65e0\u6cd5\u9a8c\u8bc1\u6d88\u606f",level:3},{value:"\u7248\u6743\u58f0\u660e",id:"\u7248\u6743\u58f0\u660e",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"\u672c\u6587\u5c06\u901a\u8fc7\u4e00\u4e2a\u5b9e\u9645\u793a\u4f8b\uff0c\u6f14\u793a\u5982\u4f55\u901a\u8fc7Hyperlane \u534f\u8bae\u53d1\u9001\u8de8\u94fe\u6d88\u606f \u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u4f60\u5c06\u5b66\u4e60\u5982\u4f55\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u90e8\u7f72\u4e0e Hyperlane Mailbox \u517c\u5bb9\u7684\u5408\u7ea6"}),"\n",(0,i.jsx)(n.li,{children:"\u90e8\u7f72\u53ef\u4fe1\u4e2d\u7ee7\u5668 ISM (\u8de8\u94fe\u5b89\u5168\u6a21\u5757)"}),"\n",(0,i.jsx)(n.li,{children:"\u8fd0\u884c\u4e00\u4e2a\u7b80\u5355\u7684\u4e2d\u7ee7\u5668"}),"\n",(0,i.jsx)(n.li,{children:"\u53d1\u9001\u8de8\u94fe\u6d88\u606f"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u793a\u4f8b\u6982\u89c8",children:"\u793a\u4f8b\u6982\u89c8"}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u60a8\u5c06\u5728\u4e24\u4e2a\u4e0d\u540c\u7684\u94fe\u4e0a\u90e8\u7f72\u7c7b\u4f3c\u7684\u5408\u7ea6\u3002\u94fe A \u4e0a\u7684\u5408\u7ea6\u5c06\u4f7f\u7528 Hyperlane \u534f\u8bae \u5411\u94fe B \u53d1\u9001\u4e00\u6761\u6d88\u606f\uff0c\u94fe B \u4e0a\u7684\u5408\u7ea6\u5c06\u5904\u7406\u6b64\u6d88\u606f\u5e76\u56de\u590d\u94fe A\u3002"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Ping Pong Flow",src:s(43952).A+"",width:"1600",height:"991"})}),"\n",(0,i.jsx)(n.p,{children:"\u5408\u7ea6\u4e3b\u8981\u529f\u80fd\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sendPing"}),(0,i.jsx)(n.em,{children:"\uff1a\u901a\u8fc7\u8c03\u7528Hyperlane"}),"\u7684\u65b9\u6cd5 \u6765\u53d1\u8d77\u8de8\u94fe\u6d88\u606f",(0,i.jsx)(n.code,{children:"IMailbox.dispatch"}),"\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"enrollRemoteRouter"}),"\uff1a\u5728\u7ee7\u627f\u7684",(0,i.jsx)(n.code,{children:"Router"}),"\u5408\u7ea6\u4e2d\uff0c\u6ce8\u518c\u6765\u81ea\u53e6\u4e00\u6761\u94fe\u7684\u5408\u7ea6\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"setInterchainSecurityModule"}),"\uff1a\u8bbe\u7f6e\u5408\u540c\u7684 ISM\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_handle"}),"\uff1a\u5904\u7406\u6765\u81ea\u90ae\u7bb1\u7684\u4f20\u5165\u6d88\u606f\uff08\u7ee7\u627f\u7684",(0,i.jsx)(n.code,{children:"Router"}),"\u5408\u7ea6",(0,i.jsx)(n.code,{children:"handle"}),"\u51fd\u6570\u8c03\u7528\u7684\u5185\u90e8\u51fd\u6570\uff09\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u5f00\u53d1\u73af\u5883\u51c6\u5907",children:"\u5f00\u53d1\u73af\u5883\u51c6\u5907"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u521b\u5efa\u5e76\u5bfc\u822a\u5230\u65b0\u76ee\u5f55\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"mkdir hyperlane-pingpong && cd hyperlane-pingpong\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u521d\u59cb\u5316 Hardhat \u9879\u76ee\u5e76\u5b89\u88c5\u4f9d\u8d56\u9879\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"npx hardhat init\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["\u6dfb\u52a0",(0,i.jsx)(n.a,{href:"https://www.npmjs.com/package/@hyperlane-xyz/core",children:(0,i.jsx)(n.code,{children:"@hyperlane-xyz/core"})}),"\u4e3a\u4f9d\u8d56\u9879\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"npm install -D @hyperlane-xyz/core\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u6d4b\u8bd5\u4ee3\u5e01",children:"\u6d4b\u8bd5\u4ee3\u5e01"}),"\n",(0,i.jsxs)(n.p,{children:["\u786e\u4fdd\u4f60\u6709\u8db3\u591f\u7684\u6d4b\u8bd5\u4ee4\u724c",(0,i.jsx)(n.code,{children:"Arbitrum Sepolia"}),"\uff0c\u5e76\u4e14",(0,i.jsx)(n.code,{children:"Sapphire Testnet"})]}),"\n",(0,i.jsx)(n.p,{children:"\u83b7\u53d6\u66f4\u591a\u4fe1\u606f\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Sapphire Testnet"}),"\u6765\u81ea",(0,i.jsx)(n.a,{href:"https://faucet.testnet.oasis.io/",children:"Oasis Faucet \u7684"}),"\u6d4b\u8bd5\u4ee3\u5e01\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Arbitrum Sepolia"}),"\u6765\u81ea Alchemy \u7684",(0,i.jsx)(n.a,{href:"https://faucets.alchemy.com/faucets/arbitrum-sepolia",children:"Faucet"}),"\u7684ETH \u4ee3\u5e01\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u5c06\u7f51\u7edc\u6dfb\u52a0\u5230-hardhat",children:"\u5c06\u7f51\u7edc\u6dfb\u52a0\u5230 Hardhat"}),"\n",(0,i.jsxs)(n.p,{children:["\u6253\u5f00",(0,i.jsx)(n.code,{children:"hardhat.config.ts"}),"\u5e76\u6dfb\u52a0 Arbitrum Sepolia \u548c Sapphire \u6d4b\u8bd5\u7f51\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"hardhat.config.ts"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:' import { HardhatUserConfig } from "hardhat/config";\n import "@nomicfoundation/hardhat-toolbox";\n\n const accounts = process.env.PRIVATE_KEY ? [process.env.PRIVATE_KEY] : [];\n\n const config: HardhatUserConfig = {\n  solidity: "0.8.24",\n  networks: {\n    \'arbitrum-sepolia\': {\n      url: \'https://arbitrum-sepolia-rpc.publicnode.com\',\n      chainId: 421614,\n      accounts,\n    },\n    \'sapphire-testnet\': {\n      url: "https://testnet.sapphire.oasis.io",\n      accounts,\n      chainId: 23295, // 0x5aff\n    },\n  },\n };\n\n export default config;\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u4e52\u4e53\u7403\u5408\u7ea6",children:"\u4e52\u4e53\u7403\u5408\u7ea6"}),"\n",(0,i.jsxs)(n.p,{children:["\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u5229\u7528\u4e86",(0,i.jsx)(n.em,{children:"Hyperlane"}),(0,i.jsx)(n.code,{children:"Router"}),"\u4e2d\u7684\u5305\u88c5\u5668\u3002\u8fd9\u5177\u6709\u4ee5\u4e0b\u4f18\u52bf\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"\u5408\u7ea6\u4e0eHyperlane"}),"\u7684",(0,i.jsx)(n.strong,{children:"MailboxClient"}),"\u548c",(0,i.jsx)(n.strong,{children:"IMessageRecipient"}),"\u63a5\u53e3\u517c\u5bb9 \u3002"]}),"\n",(0,i.jsxs)(n.li,{children:["\u652f\u6301",(0,i.jsx)(n.em,{children:"\u6ce8\u518c"}),"\u5176\u4ed6\u94fe\u7684\u8def\u7531\u5668\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:["\u652f\u6301\u8bbe\u7f6e",(0,i.jsx)(n.strong,{children:"\u81ea\u5b9a\u4e49 ISM"}),"\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Ping.sol"}),"\u521b\u5efa\u4e00\u4e2a\u540d\u4e3aArbitrum Sepolia \u7684\u65b0\u6587\u4ef6"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u5c06\u4ee5\u4e0b\u5408\u540c\u7c98\u8d34\u5230\u5176\u4e2d\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// SPDX-License-Identifier: Apache-2.0\npragma solidity ^0.8.13;\n\n// ============ External Imports ============\nimport {Router} from "@hyperlane-xyz/core/contracts/client/Router.sol";\n\n/*\n* @title Ping\n* @dev You can use this simple app as a starting point for your own application.\n*/\ncontract Ping is Router {\n    // A generous upper bound on the amount of gas to use in the handle\n    // function when a message is processed. Used for paying for gas.\n    uint256 public constant HANDLE_GAS_AMOUNT = 50_000;\n\n    // A counter of how many messages have been sent from this contract.\n    uint256 public sent;\n    // A counter of how many messages have been received by this contract.\n    uint256 public received;\n\n    // Keyed by domain, a counter of how many messages that have been sent\n    // from this contract to the domain.\n    mapping(uint32 => uint256) public sentTo;\n    // Keyed by domain, a counter of how many messages that have been received\n    // by this contract from the domain.\n    mapping(uint32 => uint256) public receivedFrom;\n\n    // ============ Events ============\n    event SentPing(\n        uint32 indexed origin,\n        uint32 indexed destination,\n        string message\n    );\n    event ReceivedPing(\n        uint32 indexed origin,\n        uint32 indexed destination,\n        bytes32 sender,\n        string message\n    );\n    event HandleGasAmountSet(\n        uint32 indexed destination,\n        uint256 handleGasAmount\n    );\n\n    constructor(address _mailbox) Router(_mailbox) {\n        // Transfer ownership of the contract to deployer\n        _transferOwnership(msg.sender);\n        setHook(address(0));\n    }\n\n    // ============ External functions ============\n\n    /**\n     * @notice Sends a message to the _destinationDomain. Any msg.value is\n     * used as interchain gas payment.\n     * @param _destinationDomain The destination domain to send the message to.\n     * @param _message The message to send.\n     */\n    function sendPing(\n        uint32 _destinationDomain,\n        string calldata _message\n    ) public payable {\n        sent += 1;\n        sentTo[_destinationDomain] += 1;\n        _dispatch(_destinationDomain, bytes(_message));\n        emit SentPing(\n            mailbox.localDomain(),\n            _destinationDomain,\n            _message\n        );\n    }\n\n    /**\n     * @notice Fetches the amount of gas that will be used when a message is\n     * dispatched to the given domain.\n     */\n    function quoteDispatch(\n        uint32 _destinationDomain,\n        bytes calldata _message\n    ) external view returns (uint256) {\n        return _quoteDispatch(_destinationDomain, _message);\n    }\n\n    // ============ Internal functions ============\n    /**\n     * @notice Handles a message from a remote router.\n     * @dev Only called for messages sent from a remote router, as enforced by Router.sol.\n     * @param _origin The domain of the origin of the message.\n     * @param _sender The sender of the message.\n     * @param _message The message body.\n     */\n    function _handle(\n        uint32 _origin,\n        bytes32 _sender,\n        bytes calldata _message\n    ) internal override {\n        received += 1;\n        receivedFrom[_origin] += 1;\n        emit ReceivedPing(\n            _origin,\n            mailbox.localDomain(),\n            _sender,\n            string(_message)\n        );\n    }\n}\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Pong.sol"}),"\u521b\u5efa\u4e00\u4e2a\u540d\u4e3aSapphire Testnet \u7684\u65b0\u6587\u4ef6"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u5c06\u4ee5\u4e0b\u5408\u540c\u7c98\u8d34\u5230\u5176\u4e2d\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// SPDX-License-Identifier: Apache-2.0\npragma solidity ^0.8.13;\n\n// ============ External Imports ============\nimport {Router} from "@hyperlane-xyz/core/contracts/client/Router.sol";\n\n/*\n* @title Pong\n* @dev You can use this simple app as a starting point for your own application.\n*/\ncontract Pong is Router {\n    // A generous upper bound on the amount of gas to use in the handle\n    // function when a message is processed. Used for paying for gas.\n    uint256 public constant HANDLE_GAS_AMOUNT = 50_000;\n\n    // A counter of how many messages have been sent from this contract.\n    uint256 public sent;\n    // A counter of how many messages have been received by this contract.\n    uint256 public received;\n\n    // Keyed by domain, a counter of how many messages that have been sent\n    // from this contract to the domain.\n    mapping(uint32 => uint256) public sentTo;\n    // Keyed by domain, a counter of how many messages that have been received\n    // by this contract from the domain.\n    mapping(uint32 => uint256) public receivedFrom;\n\n    // ============ Events ============\n    event SentPing(\n        uint32 indexed origin,\n        uint32 indexed destination,\n        string message\n    );\n    event ReceivedPing(\n        uint32 indexed origin,\n        uint32 indexed destination,\n        bytes32 sender,\n        string message\n    );\n    event HandleGasAmountSet(\n        uint32 indexed destination,\n        uint256 handleGasAmount\n    );\n\n    constructor(address _mailbox) Router(_mailbox) {\n        // Transfer ownership of the contract to deployer\n        _transferOwnership(msg.sender);\n        setHook(address(0));\n    }\n\n    // ============ External functions ============\n\n    /**\n     * @notice Sends a message to the _destinationDomain. Any msg.value is\n     * used as interchain gas payment.\n     * @param _destinationDomain The destination domain to send the message to.\n     * @param _message The message to send.\n     */\n    function sendPing(\n        uint32 _destinationDomain,\n        string calldata _message\n    ) public payable {\n        sent += 1;\n        sentTo[_destinationDomain] += 1;\n        _dispatch(_destinationDomain, bytes(_message));\n        emit SentPing(\n            mailbox.localDomain(),\n            _destinationDomain,\n            _message\n        );\n    }\n\n    /**\n     * @notice Fetches the amount of gas that will be used when a message is\n     * dispatched to the given domain.\n     */\n    function quoteDispatch(\n        uint32 _destinationDomain,\n        bytes calldata _message\n    ) external view returns (uint256) {\n        return _quoteDispatch(_destinationDomain, _message);\n    }\n\n    // ============ Internal functions ============\n    /**\n     * @notice Handles a message from a remote router.\n     * @dev Only called for messages sent from a remote router, as enforced by Router.sol.\n     * @param _origin The domain of the origin of the message.\n     * @param _sender The sender of the message.\n     * @param _message The message body.\n     */\n    function _handle(\n        uint32 _origin,\n        bytes32 _sender,\n        bytes calldata _message\n    ) internal override {\n        received += 1;\n        receivedFrom[_origin] += 1;\n        emit ReceivedPing(\n            _origin,\n            mailbox.localDomain(),\n            _sender,\n            string(_message)\n        );\n        // send return message\n        sendPing(\n            _origin,\n            string(_message)\n        );\n    }\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"ism\u5408\u540c",children:"ISM\u5408\u540c"}),"\n",(0,i.jsxs)(n.p,{children:["\u5728\u5f53\u524d\u72b6\u6001\u4e0b\uff0c\u5982\u679c\u60a8\u4ece ",(0,i.jsx)(n.code,{children:"Sapphire Testnet"})," \u5411",(0,i.jsx)(n.code,{children:"Arbitrum Sepolia"}),"\u53d1\u9001\u6d88\u606f\uff0c\u90ae\u7bb1\u7684\u9ed8\u8ba4 ISM\u5c06\u4e0d\u4f1a\u63a5\u53d7\u8be5\u6d88\u606f\u3002\u60a8\u53ef\u4ee5\u5728",(0,i.jsx)(n.code,{children:"Arbitrum Sepolia"})," \u4e0a\u90e8\u7f72\u548c\u6ce8\u518c\u81ea\u5b9a\u4e49 ISM \u4ee5\u4f7f\u5176\u6b63\u5e38\u5de5\u4f5c\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.em,{children:"Hyperlane"}),"\u7684\u4e00\u4e2a\u7b80\u5355\u9ed8\u8ba4 ISM\u662f",(0,i.jsx)(n.strong,{children:"TrustedRelayerISM"}),"\uff0c\u5b83\u5728\u4f20\u9012\u6d88\u606f\u4e4b\u524d\u68c0\u67e5\u4e2d\u7ee7\u5668\u5730\u5740\u3002"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a",(0,i.jsx)(n.code,{children:"TrustedRelayerIsm.sol"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u5c06\u4ee5\u4e0b\u5408\u540c\u7c98\u8d34\u5230\u5176\u4e2d\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// SPDX-License-Identifier: MIT OR Apache-2.0\npragma solidity >=0.8.0;\n\n// ============ Internal Imports ============\nimport {IInterchainSecurityModule} from "@hyperlane-xyz/core/contracts/interfaces/IInterchainSecurityModule.sol";\nimport {Address} from "@openzeppelin/contracts/utils/Address.sol";\nimport {Message} from "@hyperlane-xyz/core/contracts/libs/Message.sol";\nimport {Mailbox} from "@hyperlane-xyz/core/contracts/Mailbox.sol";\nimport {PackageVersioned} from "@hyperlane-xyz/core/contracts/PackageVersioned.sol";\n\ncontract TrustedRelayerIsm is IInterchainSecurityModule, PackageVersioned {\n    using Message for bytes;\n\n    uint8 public immutable moduleType = uint8(Types.NULL);\n    Mailbox public immutable mailbox;\n    address public immutable trustedRelayer;\n\n    constructor(address _mailbox, address _trustedRelayer) {\n        require(\n            _trustedRelayer != address(0),\n            "TrustedRelayerIsm: invalid relayer"\n        );\n        require(\n            Address.isContract(_mailbox),\n            "TrustedRelayerIsm: invalid mailbox"\n        );\n        mailbox = Mailbox(_mailbox);\n        trustedRelayer = _trustedRelayer;\n    }\n\n    function verify(\n        bytes calldata,\n        bytes calldata message\n    ) external view returns (bool) {\n        return mailbox.processor(message.id()) == trustedRelayer;\n    }\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u90e8\u7f72\u5408\u7ea6",children:"\u90e8\u7f72\u5408\u7ea6"}),"\n",(0,i.jsxs)(n.p,{children:["\u5206\u522b\u5728 ",(0,i.jsx)(n.code,{children:"Sapphire Testnet"}),"\u548c ",(0,i.jsx)(n.code,{children:"Arbitrum Sepolia"})," \u4e24\u4e2a\u4e0d\u540c\u7684\u94fe\u4e0a\u90e8\u7f72 Ping \u548c Pong \u5408\u7ea6\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"\u5c06-pong-\u90e8\u7f72\u5230-sapphire-testnet",children:"\u5c06 Pong \u90e8\u7f72\u5230 Sapphire Testnet"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"deploypong.ts"}),"\u5728\u4ee5\u4e0b\u4f4d\u7f6e\u521b\u5efa\u90e8\u7f72\u811a\u672c",(0,i.jsx)(n.code,{children:"scripts/"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'import { ethers } from "hardhat";\n\nasync function main() {\n  // deployed mailbox on Sapphire Testnet\n  const mailbox = "0x79d3ECb26619B968A68CE9337DfE016aeA471435";\n\n  const PongFactory = await hre.ethers.getContractFactory("Pong");    \n  const pong = await PongFactory.deploy(mailbox);\n  const pongAddr = await pong.waitForDeployment();\n  console.log(`Pong deployed at: ${pongAddr.target}`);\n}\nmain().catch((error) => {\n  console.error(error);\n  process.exitCode = 1;\n});\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u8fd0\u884c\u90e8\u7f72\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"pnpm hardhat run scripts/deploypong.ts --network sapphire-testnet\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u5c06-ping-\u90e8\u7f72\u5230-arbitrum-sepolia",children:"\u5c06 Ping \u90e8\u7f72\u5230 Arbitrum Sepolia"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"deployping.ts"}),"\u5728\u4ee5\u4e0b\u4f4d\u7f6e\u521b\u5efa\u90e8\u7f72\u811a\u672c",(0,i.jsx)(n.code,{children:"scripts/"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'import { ethers } from "hardhat";\n\nasync function main() {\n  // default mailbox on Arbitrum Sepolia\n  const mailbox = "0x598facE78a4302f11E3de0bee1894Da0b2Cb71F8";\n\n  const PingFactory = await ethers.getContractFactory("Ping");    \n  const ping = await PingFactory.deploy(mailbox);\n  const pingAddr = await ping.waitForDeployment();\n  console.log(`Ping deployed at: ${pingAddr.target}`);\n}\nmain().catch((error) => {\n  console.error(error);\n  process.exitCode = 1;\n});\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u8fd0\u884c\u90e8\u7f72\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"pnpm hardhat run scripts/deployping.ts --network arbitrum-sepolia\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u90e8\u7f72-ism-\u5230-arbitrum-sepolia",children:"\u90e8\u7f72 ISM \u5230 Arbitrum Sepolia"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"deployISM.ts"}),"\u5728\u4ee5\u4e0b\u4f4d\u7f6e\u521b\u5efa\u90e8\u7f72\u811a\u672c",(0,i.jsx)(n.code,{children:"scripts/"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'import { ethers } from "hardhat";\n\nasync function main() {\n  // default mailbox on Arbitrum Sepolia\n  const mailbox = "0x598facE78a4302f11E3de0bee1894Da0b2Cb71F8";\n  const trustedRelayer = "0x<your relayer address>";\n\n  const trustedRelayerISM = await ethers.deployContract(\n    "TrustedRelayerIsm",\n    [mailbox, trustedRelayer]\n    );\n  await trustedRelayerISM.waitForDeployment();\n  console.log(`TrustedRelayerISM deployed to ${trustedRelayerISM.target}`);\n}\n  main().catch((error) => {\n    console.error(error);\n    process.exitCode = 1;\n  });\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u8fd0\u884c\u90e8\u7f72\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"pnpm hardhat run scripts/deployISM.ts --network arbitrum-sepolia\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u5408\u7ea6\u8bbe\u7f6e",children:"\u5408\u7ea6\u8bbe\u7f6e"}),"\n",(0,i.jsxs)(n.h3,{id:"\u6ce8\u518c\u8def\u7531\u5668--router",children:["\u6ce8\u518c\u8def\u7531\u5668  ",(0,i.jsx)(n.code,{children:"Router"})]}),"\n",(0,i.jsx)(n.p,{children:"\u7531\u4e8e\u6211\u4eec\u5c06\u8def\u7531\u5668\u5305\u88c5\u5668\u7528\u4e8e\u6211\u4eec\u7684 Ping Pong \u5408\u7ea6\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u767b\u8bb0\u5bf9\u65b9\u5408\u7ea6\u7684\u5408\u7ea6\u5730\u5740\u3002"}),"\n",(0,i.jsx)(n.h4,{id:"\u5728-sapphire-testnet-\u4e0a\u6ce8\u518c-router",children:"\u5728 Sapphire Testnet \u4e0a\u6ce8\u518c Router"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"enroll.ts"}),"\u5728\u6587\u4ef6\u5939\u4e2d\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a",(0,i.jsx)(n.code,{children:"/scripts"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'import { ethers } from "hardhat";\n\nasync function main() {      \n  let pingpongArbitrum = "0x<your contract deployed before>";\n  let pingpongSapphire = "0x<your contract deployed before>";\n  let arbId = "421614";\n\n  const signer = await ethers.provider.getSigner();\n  const contract = await ethers.getContractAt("Pong", sapphireAddr, signer);\n  await contract.enrollRemoteRouter(arbId, ethers.zeroPadValue(pingpongArbitrum, 32));\n  const arbRouter = await contract.routers(arbId);\n  console.log(`remote router adr for ${arbId}: ${arbRouter}`)\n}\nmain().catch((error) => {\n  console.error(error);\n  process.exitCode = 1;\n});\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u8fd0\u884c\u90e8\u7f72"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"pnpm hardhat run scripts/enroll.ts --network sapphire-testnet\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"\u5728-arbitrum-sepolia-\u4e0a\u6ce8\u518c-router",children:"\u5728 Arbitrum Sepolia \u4e0a\u6ce8\u518c Router"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"enroll.ts"}),"\u5728\u6587\u4ef6\u5939\u4e2d\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a",(0,i.jsx)(n.code,{children:"/scripts"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'import { ethers } from "hardhat";\n\nasync function main() {\n  let pingpongArbitrum = "0x<your contract deployed before>";\n  let pingpongSapphire = "0x<your contract deployed before>";\n  let sapphireId = "23295";\n\n  const signer = await ethers.provider.getSigner();\n  const contract = await ethers.getContractAt("Ping", pingpongArbitrum, signer);\n  await contract.enrollRemoteRouter(sapphireId, ethers.zeroPadValue(pingpongSapphire, 32));\n  const arbRouter = await contract.routers(sapphireId);\n  console.log(`remote router adr for ${sapphireId}: ${arbRouter}`)\n}\nmain().catch((error) => {\n  console.error(error);\n  process.exitCode = 1;\n});\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u8fd0\u884c\u90e8\u7f72"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"pnpm hardhat run scripts/enroll.ts --network arbitrum-sepolia\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"\u5728-arbitrum-sepolia-\u6ce8\u518c-ism",children:"\u5728 Arbitrum Sepolia \u6ce8\u518c ISM"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"registerIsm.ts"}),"\u5728\u6587\u4ef6\u5939\u4e2d\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a",(0,i.jsx)(n.code,{children:"/scripts"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'import { ethers } from "hardhat";\n\nasync function main() {      \n  let pingpongArbitrum = "0x<your contract deployed before>";\n  let ismAddr = "0x<your ISM contract deployed before>";\n\n  const signer = await ethers.provider.getSigner();\n  const contract = await ethers.getContractAt("Ping", pingpongArbitrum, signer);\n  await contract.setInterchainSecurityModule(ismAddr);\n}\nmain().catch((error) => {\n  console.error(error);\n  process.exitCode = 1;\n});\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u8fd0\u884c\u90e8\u7f72"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"pnpm hardhat run scripts/registerIsm.ts --network arbitrum-sepolia\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u8fd0\u884c\u4e2d\u7ee7\u5668",children:"\u8fd0\u884c\u4e2d\u7ee7\u5668"}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u5f00\u59cb\u6d4b\u8bd5 Ping Pong \u4e4b\u524d\uff0c\u8bf7\u786e\u4fdd\u4f60\u5728 Arbitrum Sepolia \u548c Sapphire Testnet \u4e0a\u8fd0\u884c\u4e86\u4e00\u4e2a Relayer\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u8fd0\u884c\u4e2d\u7ee7\u5668\u7684\u6700\u7b80\u5355\u65b9\u6cd5\u662f\u4f7f\u7528 ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://docs.hyperlane.xyz/docs/reference/cli",children:"Hyperlane CLI"})}),"\u3002"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u5bfc\u51fa\u8981\u4e0e CLI \u4e00\u8d77\u4f7f\u7528\u7684\u79c1\u94a5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"export HYP_KEY='<YOUR_PRIVATE_KEY>'\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["\u542f\u52a8\u4e00\u4e2a\u4e2d\u7ee7\u5668 \u76d1\u89c6",(0,i.jsx)(n.code,{children:"Arbitrum Sepolia"})," & ",(0,i.jsx)(n.code,{children:"SapphireTestnet"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"hyperlane relayer --chains sapphiretestnet,arbitrumsepolia\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u94fe\u914d\u7f6e"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Sapphire Testnet"}),(0,i.jsx)(n.em,{children:"\u5df2\u5728Hyperlane Registry"}),"\u4e2d\u6ce8\u518c\uff0c\u5982\u679c\u4f60\u81ea\u5df1\u90e8\u7f72Hyperlane ",(0,i.jsx)(n.em,{children:"Core"}),(0,i.jsx)(n.code,{children:"Sapphire Testnet"}),"\uff0c\u8bf7\u786e\u4fdd\u4f60\u62e5\u6709 \u7c7b\u4f3c\u4e8e\u4e0b\u9762\u7684 ",(0,i.jsx)(n.em,{children:"Hyperlane"}),(0,i.jsx)(n.code,{children:"$HOME/.hyperlane/chains/sapphiretestnet"}),"\u914d\u7f6e\u6587\u4ef6\u3002"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"metadata.yaml"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# yaml-language-server: $schema=../schema.json\nblockExplorers:\n  - apiUrl: https://nexus.oasis.io/v1/\n    family: other\n    name: Oasis Explorer\n    url: https://explorer.oasis.io/testnet/sapphire\nchainId: 23295\ndisplayName: Sapphire Testnet\ndomainId: 23295\nisTestnet: true\nname: sapphiretestnet\nnativeToken:\n  decimals: 18\n  name: TEST\n  symbol: TEST\nprotocol: ethereum\nrpcUrls:\n  - http: https://testnet.sapphire.oasis.io\ntechnicalStack: other\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"addresses.yaml"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'domainRoutingIsmFactory: "0x3497967f8E5041f486eC559E6B760d8f051A034C"\ninterchainAccountIsm: "0xD84DE931A0EDA06Af3944a4e9933c24f3B56DCaC"\ninterchainAccountRouter: "0xFdca43771912CE5F5B4D869B0c05df0b6eF8aEFc"\nmailbox: "0x79d3ECb26619B968A68CE9337DfE016aeA471435"\nproxyAdmin: "0x5Ed8004e3352df333901b0B2E98Bd98C3B4AA59A"\nstaticAggregationHookFactory: "0x212c232Ee07E187CF9b4497A30A3a4D034aAC4D6"\nstaticAggregationIsmFactory: "0xE25A539AdCa1Aac56549997f2bB88272c5D9498c"\nstaticMerkleRootMultisigIsmFactory: "0x9851EC4C62943E9974370E87E93CE552abE7705E"\nstaticMerkleRootWeightedMultisigIsmFactory: "0x688dE6d0aBcb60a711f149c274014c865446b49D"\nstaticMessageIdMultisigIsmFactory: "0xFE0937b1369Bbba59211c4119B91984FF450ccf1"\nstaticMessageIdWeightedMultisigIsmFactory: "0x1de05675c8cd512A30c17Ea0a3491d74eF290994"\ntestRecipient: "0x7bf548104F8f500C563Aa6DC7FbF3b1ad93E4E03"\nvalidatorAnnounce: "0xB119f96a106919489b6495128f30e7088e55B05c"\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u5bf9\u4e8e\u66f4\u590d\u6742\u7684\u9a8c\u8bc1\u5668\u548c\u4e2d\u7ee7\u5668\u8bbe\u7f6e\uff0c\u8bf7\u67e5\u770b Hyperlane \u7684 ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://docs.hyperlane.xyz/docs/guides/deploy-hyperlane-local-agents",children:"\u672c\u5730\u4ee3\u7406\u6307\u5357"})})," \u6216\u66f4\u9002\u5408\u751f\u4ea7\u7684 ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://docs.hyperlane.xyz/docs/operate/overview-agents",children:"\u4ee3\u7406\u64cd\u4f5c\u5458\u6307\u5357"})}),"\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"\u6267\u884c\u4e52\u4e53\u7403",children:"\u6267\u884c\u4e52\u4e53\u7403"}),"\n",(0,i.jsxs)(n.p,{children:["\u8981\u6267\u884c\uff0c\u60a8\u5c06\u8c03\u7528 Ping.sol \u5408\u7ea6\u7684 ",(0,i.jsx)(n.code,{children:"sendPing"}),"\u51fd\u6570\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u5728\u793a\u4f8b\u4e2d\uff0c",(0,i.jsx)(n.code,{children:"demo-opl"}),"\u60a8\u53ef\u4ee5\u4f7f\u7528\u63d0\u4f9b\u7684",(0,i.jsx)(n.code,{children:"send-ping"}),"\u4efb\u52a1\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u811a\u672c\uff1a"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"sendping.ts"}),"\u5728\u6587\u4ef6\u5939\u4e2d\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a",(0,i.jsx)(n.code,{children:"/scripts"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'import { ethers } from "hardhat";\n\nasync function main() {\n  const destChainId = "23295";\n  const message = "Hello OPL"\n  const pingpongArbitrum = "0x<your pingpong contract deployed on arbitrum sepolia"\n\n  const signer = await ethers.provider.getSigner();\n  const contract = await ethers.getContractAt("Ping", pingpongArbitrum, signer);\n\n  console.log("Calculating fee...");\n  let fee = await contract.quoteDispatch(\n      destChainId,\n      hre.ethers.toUtf8Bytes(message));\n  console.log(`Fee: ${hre.ethers.formatEther(fee)} ETH`);\n  console.log("Sending message...");\n  const tx = await contract.sendPing(destChainId, message, {value: fee});\n  await tx.wait();\n  console.log("Message sent");\n}\nmain().catch((error) => {\n  console.error(error);\n  process.exitCode = 1;\n});\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u8fd0\u884c\u811a\u672c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"pnpm hardhat run scripts/sendping.ts --network arbitrum-sepolia\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u9a8c\u8bc1\u4e52\u4e53",children:"\u9a8c\u8bc1\u4e52\u4e53"}),"\n",(0,i.jsxs)(n.p,{children:["\u9a8c\u8bc1\u8de8\u94fe\u6d88\u606f\u4f20\u9012\u7684\u6700\u7b80\u5355\u65b9\u6cd5\u662f\u68c0\u67e5\u533a\u5757\u94fe\u6d4f\u89c8\u5668\u5e76\u68c0\u67e5\u5df2\u90e8\u7f72 ",(0,i.jsx)(n.code,{children:"Ping"})," \u5408\u7ea6\u4e0a\u7684\u4ea4\u6613\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679c\u60a8\u60f3\u76f4\u63a5\u76d1\u89c6\u4e8b\u4ef6\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u811a\u672c\uff1a"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"verifyping.ts"}),"\u5728\u6587\u4ef6\u5939\u4e2d\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a",(0,i.jsx)(n.code,{children:"/scripts"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"import { ethers } from \"hardhat\";\n\nasync function main() {\n  const contractAddr = \"0x<your deployed ping contract on arbitrum sepolia>\"\n  const signer = await ethers.provider.getSigner();\n  const contract = await ethers.getContractAt(\"Ping\", contractAddr, signer);\n\n  const spinner = ['-', '\\\\', '|', '/'];\n  let spinnerIndex = 0;\n  const interval = setInterval(() => {\n      process.stdout.write(`\\rListing for event... ${spinner[spinnerIndex]}`);\n      current = (spinnerIndex + 1) % spinner.length;\n  }, 150);\n\n  let events;\n  do {\n    const block = await ethers.provider.getBlockNumber();\n    events = await contract.queryFilter('ReceivedPing', block - 10, 'latest');\n    if (events.length === 0) {\n      await new Promise(resolve => setTimeout(resolve, 60 * 1000));\n    }\n  } while (events.length === 0);\n\n  clearInterval(interval);\n  process.stdout.write(`\\r`); \n  process.stdout.clearLine(0);\n\n  const parsedEvent = contract.interface.parseLog(events[0]);\n  const message = parsedEvent?.args?.message;\n  console.log(`Message received with: ${message}`);\n}\nmain().catch((error) => {\n  console.error(error);\n  process.exitCode = 1;\n});\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u8fd0\u884c\u811a\u672c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"pnpm hardhat run scripts/verifyping.ts --network sapphire-testnet\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u6545\u969c\u6392\u9664",children:"\u6545\u969c\u6392\u9664"}),"\n",(0,i.jsx)(n.h3,{id:"\u4e2d\u7ee7\u5668\u4e0d\u4e2d\u7ee7\u6d88\u606f",children:"\u4e2d\u7ee7\u5668\u4e0d\u4e2d\u7ee7\u6d88\u606f"}),"\n",(0,i.jsx)(n.p,{children:"\u67e5\u770b\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"enrollRemoteRouter"})," \u60a8\u5df2\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u6ce8\u518c\u4e86\u5bf9\u9762\u7684\u8def\u7531\u5668\u5408\u7ea6\uff1a",(0,i.jsx)(n.code,{children:"ping.routers(oppositeChainId)"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Arbitrum Sepolia"}),"\u60a8\u5df2\u901a\u8fc7\u8c03\u7528\u4ee5\u4e0b\u65b9\u5f0f\u5728 Ping \u5408\u7ea6\u4e0a\u8bbe\u7f6e\u4e86\u81ea\u5b9a\u4e49 ISM",(0,i.jsx)(n.code,{children:"ping.interchainSecurityModule"})]}),"\n",(0,i.jsx)(n.li,{children:"\u4e2d\u7ee7\u5668\u5730\u5740\u4e0e\u53d7\u4fe1\u4efb\u7684 ISM \u914d\u7f6e\u76f8\u5339\u914d\u3002"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u65e0\u6cd5\u9a8c\u8bc1\u6d88\u606f",children:"\u65e0\u6cd5\u9a8c\u8bc1\u6d88\u606f"}),"\n",(0,i.jsx)(n.p,{children:"\u67e5\u770b\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u60a8\u7684 Hardhat RPC \u5141\u8bb8\u5386\u53f2\u4e8b\u4ef6\u67e5\u8be2\u3002"}),"\n",(0,i.jsx)(n.li,{children:"\u5982\u679c\u6709\u5fc5\u8981\uff0c\u8bf7\u4f7f\u7528\u4e13\u7528\u7684 RPC \u63d0\u4f9b\u7a0b\u5e8f\uff08\u4f8b\u5982 Alchemy\uff09\u3002"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u7248\u6743\u58f0\u660e",children:"\u7248\u6743\u58f0\u660e"}),"\n",(0,i.jsxs)(n.p,{children:["\u672c\u6587\u6e90\u81ea ",(0,i.jsx)(n.a,{href:"https://docs.oasis.io/build/opl/hyperlane/pingpong-example/",children:"Ping Pong Example"})," by ",(0,i.jsx)(n.a,{href:"https://docs.oasis.io/",children:"Oasis"}),"\uff0c\u5728\u5176\u57fa\u7840\u4e0a\u7ffb\u8bd1\u6210\u4e2d\u6587\u5e76\u4f5c\u51fa\u4e00\u4e9b\u8c03\u6574\uff0c\u4f60\u53ef\u4ee5\u5728 Oasis \u7684 ",(0,i.jsx)(n.a,{href:"https://github.com/oasisprotocol/demo-opl/tree/main/examples/hyperlane-pingpong",children:"demo-opl \u5b58\u50a8\u5e93"}),"\u4e2d\u627e\u5230\u7528\u4e8e\u90e8\u7f72\u548c\u6267\u884c\u7684\u5408\u7ea6\u6e90\u4ee3\u7801\u548c Hardhat \u914d\u7f6e\u3002"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},31406:e=>{e.exports=JSON.parse('{"permalink":"/blog/in-depth-analysis-03","source":"@site/blog/2025/04/11/Hyperlane \u6df1\u5ea6\u89e3\u6790\uff083\uff09\uff1a\u6784\u5efa\u8de8\u94fe\u901a\u4fe1\u5b9e\u8df5\u2014\u4e52\u4e53\u7403\u793a\u4f8b.md","title":"Hyperlane \u6df1\u5ea6\u89e3\u6790\uff083\uff09\uff1a\u6784\u5efa\u8de8\u94fe\u901a\u4fe1\u5b9e\u8df5\u2014\u4e52\u4e53\u7403\u793a\u4f8b","description":"\u6784\u5efa\u8de8\u94fe\u901a\u4fe1\u5b9e\u8df5\u2014\u4e52\u4e53\u7403\u793a\u4f8b","date":"2025-04-11T00:00:00.000Z","tags":[{"inline":true,"label":"hyperlane","permalink":"/blog/tags/hyperlane"},{"inline":true,"label":"\u8de8\u94fe\u6865","permalink":"/blog/tags/\u8de8\u94fe\u6865"},{"inline":true,"label":"\u901a\u4fe1\u5b9e\u8df5","permalink":"/blog/tags/\u901a\u4fe1\u5b9e\u8df5"},{"inline":true,"label":"\u793a\u4f8b","permalink":"/blog/tags/\u793a\u4f8b"}],"readingTime":9.753333333333334,"hasTruncateMarker":true,"authors":[{"name":"\u56fd\u5b50","title":"Author of @AmphitheatreApp / Contributor of @Alux_Network / PMC of @OpenBuildxyz / Compiler Researcher of http://github.com/hummanta / Rustacean \ud83e\udd80","url":"https://hyperlane.cc","socials":{"x":"https://x.com/wangeguo","github":"https://github.com/wangeguo"},"imageURL":"https://pbs.twimg.com/profile_images/1756464684805550080/1q_bCFPG_400x400.jpg","key":"wangeguo","page":null},{"name":"hyperlane \u4e2d\u6587","title":"Hyperlane \u4e2d\u6587\u56e2\u961f","url":"https://hyperlane.cc","socials":{"x":"https://x.com/HyperlaneCC","github":"https://github.com/HyperlaneDevCN"},"imageURL":"https://avatars.githubusercontent.com/u/200944122?s=400&u=4df9ecfb6bf546730a5e7f6e406882765eac1772&v=4","key":"HyperlaneCC","page":null}],"frontMatter":{"title":"Hyperlane \u6df1\u5ea6\u89e3\u6790\uff083\uff09\uff1a\u6784\u5efa\u8de8\u94fe\u901a\u4fe1\u5b9e\u8df5\u2014\u4e52\u4e53\u7403\u793a\u4f8b","description":"\u6784\u5efa\u8de8\u94fe\u901a\u4fe1\u5b9e\u8df5\u2014\u4e52\u4e53\u7403\u793a\u4f8b","slug":"in-depth-analysis-03","authors":["wangeguo","HyperlaneCC"],"tags":["hyperlane","\u8de8\u94fe\u6865","\u901a\u4fe1\u5b9e\u8df5","\u793a\u4f8b"],"image":"https://cdn.prod.website-files.com/6686ac1afeef42fcf1929457/6686c26718cec2e458cc5d7a_logo.svg","hide_table_of_contents":true},"unlisted":false,"nextItem":{"title":"Hyperlane \u53d1\u5e01\u5728\u5373\uff0c\u8be6\u89e3\u7a7a\u6295\u6807\u51c6\u548c HYPER \u4ee3\u5e01\u673a\u5236","permalink":"/blog/Hyperlane_Airdrop"}}')},43952:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/pingpong-flow-6c871f9e5ca11c65ad5a21b6e7fbbd32.png"}}]);