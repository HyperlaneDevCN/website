# Hyperlane æœ¬åœ°è®¾ç½®æŒ‡å—ï¼šåœ¨ Anvil èŠ‚ç‚¹ä¹‹é—´å‘é€æ¶ˆæ¯

æœ¬æŒ‡å—å°†å¼•å¯¼æ‚¨é€šè¿‡ Hyperlane CLI åœ¨ä¸¤ä¸ªæœ¬åœ° Anvil èŠ‚ç‚¹ä¹‹é—´å‘é€è·¨é“¾æ¶ˆæ¯ã€‚

## å‰ææ¡ä»¶

- **[Hyperlane CLI](https://hyperlanedevcn.github.io/website/docs/reference/cli)ï¼š** ç¡®ä¿æ‚¨å·²å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ Hyperlane CLIã€‚

  ```bash
  npm install -g @hyperlane-xyz/cli
  ```

- **[Anvil (foundry)](https://book.getfoundry.sh/getting-started/installation)ï¼š** å®‰è£…ä»¥è¿è¡Œæœ¬åœ°é“¾ã€‚é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š
  ```bash
  curl -L https://foundry.paradigm.xyz | bash
  ```
- **Node.js**ï¼ˆv18 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰
- **éƒ¨ç½²è€…é’±åŒ…ç§é’¥**ï¼šæ‚¨éœ€è¦ä¸€ä¸ªæœ‰èµ„é‡‘çš„é’±åŒ…æ¥éƒ¨ç½²åˆçº¦ã€‚è¿™å°†ç”¨ä½œ HYP_KEYã€‚
  ```bash
  export HYP_KEY=<YOUR_PRIVATE_KEY>
  ```

## æ­¥éª¤æŒ‡å—

### 1. ç¯å¢ƒè®¾ç½®ï¼šä¸º Hyperlane é…ç½®åˆ›å»ºä¸€ä¸ªå·¥ä½œç›®å½•ï¼š

```bash
mkdir hyperlane-local-test && cd hyperlane-local-test
```

### 2. å¯åŠ¨ä¸¤ä¸ªä¸åŒçš„ Anvil èŠ‚ç‚¹

æˆ‘ä»¬å°†è¿è¡Œä¸¤ä¸ªå…·æœ‰å”¯ä¸€é“¾ ID çš„ Anvil èŠ‚ç‚¹ã€‚

- åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸Šï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ª Anvil èŠ‚ç‚¹ï¼š

  ```bash
  anvil --port 8545 --chain-id 31337 --block-time 1
  ```

  - è¿è¡Œåœ¨ `http://localhost:8545`ã€‚
  - é“¾ IDï¼š`31337`ã€‚

- åœ¨æ–°ç»ˆç«¯ä¸­ï¼Œå¯åŠ¨ç¬¬äºŒä¸ª Anvil èŠ‚ç‚¹ï¼š

  ```bash
  anvil --port 8546 --chain-id 31338 --block-time 1
  ```

  - è¿è¡Œåœ¨ `http://localhost:8546`ã€‚
  - é“¾ IDï¼š`31338`ã€‚

### 3. åˆå§‹åŒ– Hyperlane æ³¨å†Œè¡¨

åœ¨æ–°ç»ˆç«¯ä¸­ï¼Œä½¿ç”¨ Hyperlane CLI ä¸ºä¸¤ä¸ª Anvil èŠ‚ç‚¹åˆ›å»ºé…ç½®ï¼š

```bash
hyperlane registry init
```

æŒ‰ç…§æç¤ºè®¾ç½® `anvilnode1`ã€‚CLI å°†è¯¢é—®æ‚¨æœ‰å…³é“¾çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ chainId å’Œ RPC URLã€‚å¯¹ `anvilnode2` é‡å¤æ­¤è¿‡ç¨‹ã€‚

æ­¤è¿‡ç¨‹å°†åœ¨ `$HOME/.hyperlane/chains/anvilnode1` å’Œ `$HOME/.hyperlane/chains/anvilnode2` ä¸‹åˆ›å»º `metadata.yaml` æ–‡ä»¶ã€‚

ç¤ºä¾‹å…ƒæ•°æ®ï¼š

- **anvilnode1**

```yaml
chainId: 31337
displayName: Anvilnode1
domainId: 31337
isTestnet: true
name: anvilnode1
nativeToken:
  decimals: 18
  name: ETH
  symbol: ETH
protocol: ethereum
rpcUrls:
  - http: http://localhost:8545
```

- **anvilnode2**

```yaml
chainId: 31338
displayName: Anvilnode2
domainId: 31338
isTestnet: true
name: anvilnode2
nativeToken:
  decimals: 18
  name: ETH
  symbol: ETH
protocol: ethereum
rpcUrls:
  - http: http://localhost:8546
```

### 4. éƒ¨ç½²æ ¸å¿ƒåˆçº¦

æˆ‘ä»¬å°†é…ç½®å¹¶éƒ¨ç½² Hyperlane æ ¸å¿ƒåˆçº¦ã€‚

:::tip
æ‚¨éœ€è¦éƒ¨ç½²æ ¸å¿ƒåˆçº¦çš„éƒ¨ç½²è€…é’±åŒ…ç§é’¥ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ `export HYP_KEY='<YOUR_PRIVATE_KEY>'` å°†ç§é’¥è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ã€‚
:::

```bash
hyperlane core init
```

éƒ¨ç½²é…ç½®å°†ä¿å­˜åˆ° `./configs/core-config.yaml`ã€‚

æ¥ä¸‹æ¥ï¼Œéƒ¨ç½²æ ¸å¿ƒåˆçº¦ï¼š

```bash
hyperlane core deploy
```

æŒ‰ç…§æç¤ºé€‰æ‹© `anvilnode1`ã€‚CLI å°†éƒ¨ç½²é‚®ç®±ã€è·¨é“¾å®‰å…¨æ¨¡å—ï¼ˆISMï¼‰å’Œå…¶ä»–æ‰€éœ€åˆçº¦ã€‚å¯¹ `anvilnode2` é‡å¤æ­¤è¿‡ç¨‹ã€‚

å®Œæˆåï¼Œæ‚¨å°†åœ¨ `$HOME/.hyperlane/chains/anvilnode1` å’Œ `$HOME/.hyperlane/chains/anvilnode2` ä¸­æ‰¾åˆ° `addresses.yaml`ï¼Œå…¶ä¸­åŒ…å«å·²éƒ¨ç½²çš„åˆçº¦åœ°å€ã€‚

:::tip
æ‚¨åº”è¯¥èƒ½å¤Ÿåœ¨è¿è¡Œæœ¬åœ°èŠ‚ç‚¹çš„ç»ˆç«¯ä¸Šçœ‹åˆ°åˆçº¦éƒ¨ç½²çš„æ¶ˆæ¯ã€‚
:::

### 5. å‘é€æµ‹è¯•æ¶ˆæ¯

ä½¿ç”¨ Hyperlane CLI ä» `anvilnode1` å‘ `anvilnode2` å‘é€æ¶ˆæ¯ã€‚

```bash
hyperlane send message --relay
```

CLI å°†æç¤ºæ‚¨æä¾›æºé“¾ï¼ˆ`anvilnode1`ï¼‰å’Œç›®æ ‡é“¾ï¼ˆ`anvilnode2`ï¼‰ã€‚

:::tip

å¯¹äºæœ¬åœ°æµ‹è¯•ï¼Œ`--relay` æ ‡å¿—ä¼šè‡ªåŠ¨å°†æ¶ˆæ¯ä¸­ç»§åˆ°ç›®æ ‡é“¾ã€‚

:::

å‘é€æ¶ˆæ¯åï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š

- éªŒè¯è€…æ—¥å¿—ï¼šæŸ¥æ‰¾æŒ‡ç¤ºç”Ÿæˆå’Œå­˜å‚¨ç­¾åçš„æ¡ç›®ã€‚
- ä¸­ç»§å™¨æ—¥å¿—ï¼šæŸ¥æ‰¾æˆåŠŸæ£€ç´¢å…ƒæ•°æ®å’Œæ¶ˆæ¯å¤„ç†çš„è®°å½•ã€‚
- Anvil æ—¥å¿—ï¼šç¡®ä¿å·²æŒ–æ˜åŒºå—ä»¥å¤„ç†äº¤æ˜“ã€‚

:::success
ğŸ‰ æ‚¨å·²ä½¿ç”¨ Hyperlane åœ¨ä¸¤ä¸ªæœ¬åœ° Anvil èŠ‚ç‚¹ä¹‹é—´å‘é€äº†æ¶ˆæ¯ï¼
:::

## æ•…éšœæ’é™¤

1. â€œæ— æ³•è·å–å…ƒæ•°æ®â€è­¦å‘Šï¼š

   - **åŸå› ï¼š** å½“ä¸­ç»§å™¨æ— æ³•æ£€ç´¢å¤„ç†æ¶ˆæ¯æ‰€éœ€çš„éªŒè¯è€…ç­¾åæ—¶ï¼Œä¼šå‘ç”Ÿæ­¤æƒ…å†µã€‚å¸¸è§åŸå› ï¼š
     - éªŒè¯è€…å¯†é’¥ç¼ºä¹æµ‹è¯•ç½‘èµ„é‡‘ã€‚
     - éªŒè¯è€…å°šæœªå®£å¸ƒå…¶å­˜å‚¨ä½ç½®ã€‚
   - **è§£å†³æ–¹æ¡ˆï¼š**
     - ç¡®ä¿éªŒè¯è€…å·²å®£å¸ƒå…¶å­˜å‚¨ä½ç½®ã€‚æ£€æŸ¥éªŒè¯è€…æ—¥å¿—ä»¥æŸ¥æ‰¾ç±»ä¼¼ä»¥ä¸‹æ¶ˆæ¯ï¼š`Validator has announced signature storage location, locations: ["file:///tmp/hyperlane-validator-signatures-local"].`
     - éªŒè¯æ¯ä¸ªéªŒè¯è€…æ˜¯å¦å…·æœ‰å”¯ä¸€çš„ç­¾åå­˜å‚¨è·¯å¾„ï¼ˆ`--checkpointSyncer.path`ï¼‰ï¼Œä»¥é˜²æ­¢è¦†ç›–ã€‚
     - ç¡®è®¤ä¸­ç»§å™¨å¯¹å­˜å‚¨è·¯å¾„å…·æœ‰è¯»å–æƒé™ã€‚

2. æ¶ˆæ¯è¶…æ—¶ï¼š

   - **åŸå› ï¼š** Anvil é»˜è®¤ä¸è‡ªåŠ¨æŒ–æ˜åŒºå—ï¼Œå¯¼è‡´éªŒè¯è€…æˆ–ä¸­ç»§å™¨æ— é™æœŸç­‰å¾…æ–°å—ã€‚
   - **è§£å†³æ–¹æ¡ˆï¼š** ç¡®ä¿åœ¨å¯åŠ¨ Anvil æ—¶ä½¿ç”¨ `--block-time 1` æ ‡å¿—ï¼Œä»¥æ¯ç§’è‡ªåŠ¨æŒ–æ˜åŒºå—ã€‚

3. éªŒè¯è€…ä¸åŒ¹é…æˆ–é…ç½®é”™è¯¯ï¼š

   - **åŸå› ï¼š** ç›®æ ‡é“¾ä¸Šçš„ ISM é…ç½®ä¸æºé“¾ä½¿ç”¨çš„éªŒè¯è€…å¯†é’¥ä¸åŒ¹é…ã€‚
   - **è§£å†³æ–¹æ¡ˆï¼š** æ£€æŸ¥ ISM é…ç½®æ˜¯å¦åŒ…å«æ­£ç¡®çš„éªŒè¯è€…åœ°å€ã€‚éªŒè¯è€…æ—¥å¿—å¯ä»¥å¸®åŠ©è¯†åˆ«å·²å®£å¸ƒçš„åœ°å€ã€‚
